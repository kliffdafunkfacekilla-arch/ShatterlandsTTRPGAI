INFO: Gemini AI Client initialized.
INFO: GameStateManager initialized
INFO: Orchestrator: Initializing Local Combat Manager...
INFO: LocalCombatManager initialized
INFO: Orchestrator: Initializing Local World Sim...
INFO: Orchestrator: Initializing Local Campaign Director...
INFO: Orchestrator initialized
INFO: Initializing game engine...
INFO: RuleSetContainer instance created (not yet loaded)
INFO: ============================================================
INFO: LOADING GAME RULES DATA
INFO: ============================================================
INFO: Loaded: stats_and_skills.json
INFO: Processed 12 stats and 72 skills
INFO: Loaded: abilities.json
INFO: Built 320 ability lookups
INFO: Loaded: talents.json
INFO: Built 42 talent lookups
INFO: Loaded: kingdom_features.json
INFO: Processed 60 kingdom features
INFO: Loaded: melee_weapons.json
INFO: Loaded: ranged_weapons.json
INFO: Loaded: armor.json
INFO: Loaded: injury_effects.json
INFO: Loaded: status_effects.json
INFO: Loaded: origin_choices.json
INFO: Loaded: childhood_choices.json
INFO: Loaded: coming_of_age_choices.json
INFO: Loaded: training_choices.json
INFO: Loaded: devotion_choices.json
INFO: Loaded: npc_templates.json
INFO: Loaded: item_templates.json
INFO: Loaded: generation_rules.json
INFO: Loaded: loot_tables.json
INFO: ============================================================
INFO: RULES DATA LOADED SUCCESSFULLY
INFO: ============================================================
INFO:   stats: 12
INFO:   skills: 72
INFO:   abilities: 320
INFO:   talents: 42
INFO:   kingdom_features: 60
INFO:   melee_weapons: 12
INFO:   ranged_weapons: 12
INFO:   armor: 12
INFO:   status_effects: 12
INFO:   injury_effects: 4
INFO:   npc_templates: 4
INFO:   item_templates: 21
INFO:   origin_choices: 3
INFO:   childhood_choices: 3
INFO:   coming_of_age_choices: 3
INFO:   training_choices: 3
INFO:   devotion_choices: 3
INFO:   load_errors: 0
INFO: Rules loaded: {'stats': 12, 'skills': 72, 'abilities': 320, 'talents': 42, 'kingdom_features': 60, 'melee_weapons': 12, 'ranged_weapons': 12, 'armor': 12, 'status_effects': 12, 'injury_effects': 4, 'npc_templates': 4, 'item_templates': 21, 'origin_choices': 3, 'childhood_choices': 3, 'coming_of_age_choices': 3, 'training_choices': 3, 'devotion_choices': 3, 'load_errors': 0}
INFO: Game engine initialization complete
INFO: Starting new game with 2 characters
INFO: Loading character from: C:\Users\krazy\Documents\GitHub\ShatterlandsTTRPGAI\characters\Test Hero 2.json
INFO: Character loaded: Test Hero 2
INFO: Loading character from: C:\Users\krazy\Documents\GitHub\ShatterlandsTTRPGAI\characters\Test Hero 2.json
INFO: Character loaded: Test Hero 2
INFO: Loaded 2 characters
INFO: Game state loaded: 2 characters
INFO: Starting save game to slot: CurrentSave
INFO: Save complete: saves\CurrentSave.json
INFO: New game started successfully
Traceback (most recent call last):
  File "C:\Users\krazy\Documents\GitHub\ShatterlandsTTRPGAI\test_gameplay_loop.py", line 110, in <module>
    asyncio.run(run_test())
    ~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Python313\Lib\asyncio\runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "C:\Python313\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\krazy\Documents\GitHub\ShatterlandsTTRPGAI\test_gameplay_loop.py", line 65, in run_test
    if move_result["success"]:
       ~~~~~~~~~~~^^^^^^^^^^^
TypeError: 'NoneType' object is not subscriptable
=== Starting Gameplay Loop Test ===

[1] Initializing Engine...
    Engine Initialized.

[2] Starting New Game...
--- Map Generator: Loading Data ---
Loaded 6 tile definitions.
Loaded 2 generation algorithms.
--- Map Generator: Data Loaded ---
Running generation using algorithm: Forest Clearing (cellular_automata) with seed: start_seed_12345
Applying post-processing step: add_border_trees
Applying post-processing step: clear_center
Requesting Map Flavor from AI...
AI returned empty flavor, using fallback.
    Game Started. Players: 2
    Active Player: Test Hero 2 (ID: b487c429-d438-503b-cfc9-8e5fefec2d73)
    Position: (3, 28)

[3] Testing Movement...
    Requesting move to (4, 28)...

FATAL ERROR: 'NoneType' object is not subscriptable
